from src.functions.prepare_braze_messages import app


def test_prepare_braze_messages():

    event = {
              "country": "BR",
              "store": "DAFITI",
              "braze": {
                "canvas_id": "XPTO",
                "objects_limit": 50
              },
              "audience": [
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970",
                "102901abc123", "91029109gh1234", "012816278obc321", "00218279odb10182", "0726187913bsg81970"
              ]
            }

    for _ in range(30):
        message = app.lambda_handler(event, "")

        expected_message = [{"MessageAttributes": {"Action": "canvas_trigger_send"}, "MessageBody": {"canvas_id": "XPTO", "recipients": [{"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}]}}, {"MessageAttributes": {"Action": "canvas_trigger_send"}, "MessageBody": {"canvas_id": "XPTO", "recipients": [{"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}]}}, {"MessageAttributes": {"Action": "canvas_trigger_send"}, "MessageBody": {"canvas_id": "XPTO", "recipients": [{"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "102901abc123"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "91029109gh1234"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "012816278obc321"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "00218279odb10182"}}, {"user_alias": {"alias_label": "DAFITI BRAZIL", "alias_name": "0726187913bsg81970"}}]}}]

        assert message == expected_message
